# How It Works

- Snippet included on page (contains a Publisher Id and a link to a script)
- This link is used to load a small Bootstrap JS file.
- Bootstrap JS does a number of things:
  - Decache - remove any references to Neon images from cached copies and points back to the original
  - Lazy loads jQuery (if it doesn&#39;t already exist in the project)
  - Lazy loads in the Main JS
- Main JS:
  - There are three main events that are sent to reporting:
    - Image Load - when a Neon image is loaded
    - Image View - when a Neon image comes into view (the viewport), this fires once for each image as we keep track of it being visible.
    - Image Click - when a Neon image is clicked
  - The Tracker checks the DOM for nodes that contain Neon images.
  - The Tracker watches for new nodes that are added to the DOM. When they are, those nodes are checked for Neon images.
  - There is a blacklist of nodes that are not checked.
  - Neon images can be background, <img>, lazy loaded images (we check a number of common patterns)
  - Tracker can run in two slightly different ways.
    - normal (default)
      - We add a click handler to each image that is served from the neon-images domain
      - We fire an API call (batched where necessary) to work out the `thumbnail_id` and `video_id` (this is done via injecting a script tag / iframe to make a cross-domain request)
    - simple
      - adds a click handler to each anchor on the page
      - maintains a map of (anchor) `url: thumbnail_id`
      - when any anchor is clicked, the `thumbnail_id` and `video_id` is pulled from the map and used to register an Image Click
