var _neon=_neon||{},neonPageId=null,neonPublisherId="2089095449",trackerType="IGN",lastMouseClick,lastMouseClickElement;function _trackLastMouseClick(b){var a;b=b?b:event;b.srcElement?a=b.srcElement:b.target&&(a=b.target);lastMouseClickElement=a.localName;"object"==lastMouseClickElement&&(lastMouseClick=(new Date).getTime())}document.onmouseup=_trackLastMouseClick;Object.size=function(b){var a=0,e;for(e in b)b.hasOwnProperty(e)&&a++;return a};
(function(b){function a(){g=!1;for(var c in e){var a=b(e[c]).filter(function(){return b(this).is(":appeared")});a.trigger("appear",[a]);if(d){var f=d.not(a);f.trigger("disappear",[f])}d=a}}var e=[],k=!1,g=!1,m={interval:250,force_process:!1},c=b(window),d;b.expr[":"].appeared=function(a){a=b(a);if(!a.is(":visible"))return!1;var h=c.scrollLeft(),d=c.scrollTop(),e=a.offset(),g=e.left,e=e.top;return e+a.height()>=d&&e-(a.data("appear-top-offset")||0)<=d+c.height()&&g+a.width()>=h&&g-(a.data("appear-left-offset")||
0)<=h+c.width()?!0:!1};b.fn.extend({appear:function(c){var h=b.extend({},m,c||{});c=this.selector||this;if(!k){var d=function(){g||(g=!0,setTimeout(a,h.interval))};b(window).scroll(d).resize(d);k=!0}h.force_process&&setTimeout(a,h.interval);e.push(c);return b(c)}});b.extend({force_appear:function(){return k?(a(),!0):!1}})})(_neonjQuery);
(function(b){_neon.JsonRequester=function(){function a(b){this.fullUrl=b;this.noCacheIE="&noCacheIE="+(new Date).getTime();this.headLoc=document.getElementsByTagName("head").item(0);this.scriptId="JscriptId"+a.scriptCounter++}a.scriptCounter=1;a.prototype.buildScriptTag=function(){this.scriptObj=document.createElement("script");this.scriptObj.setAttribute("type","text/javascript");this.scriptObj.setAttribute("charset","utf-8");this.scriptObj.setAttribute("src",this.fullUrl+this.noCacheIE);this.scriptObj.setAttribute("id",
this.scriptId)};a.prototype.removeScriptTag=function(){this.headLoc.removeChild(this.scriptObj)};a.prototype.addScriptTag=function(){this.headLoc.appendChild(this.scriptObj)};return{sendRequest:function(b){try{bObj=new a(b),bObj.buildScriptTag(),bObj.addScriptTag()}catch(k){}}}}();_neon.utils={getRandomString:function(a){return parseInt(1E8*(1+Math.random()),10).toString().substr(0,a)},isHidden:function(a){return null===a.offsetParent?!0:!1},isAnchor:function(a){return"A"==a.prop("tagName")},sameSiteReferral:function(){var a=
document.referrer;-1!==a.indexOf("http://")?a=a.substr(7):-1!==a.indexOf("https://")&&(a=a.substr(8));return a==window.location.hostname},getPageRequestUUID:function(){for(var a="",b=16;0<b;--b)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a},isOnScreen:function(a){a=b(a);var e=b(window),k=e.scrollTop(),g=e.scrollLeft(),m;m=g+e.width();var e=k+e.height(),c=a.offset();c.right=c.left+a.outerWidth();c.bottom=c.top+a.outerHeight();return!(m<c.left||
g>c.right||e<c.top||k>c.bottom)},getBackgroundImageUrl:function(a){a=b(a).css("background-image");a=a.replace("url(","").replace(")","");return a.substr(7)},getQueryValue:function(a,b){for(var k=a&&a.substring(1).split("&"),g=0,m=k.length;g<m;g++){var c=k[g],d=c.indexOf("=");if((c&&c.substring(0,d))===b)return c.substring(d+1,c.length)}}};_neon.tracker=function(){function a(){for(var a=document.getElementsByTagName("div"),c=a.length,b,d=[],n=0;n<c;n++)b=a[n],b.currentStyle?"none"!==b.currentStyle.backgroundImage&&
d.push(b):window.getComputedStyle&&"none"!==document.defaultView.getComputedStyle(b,null).getPropertyValue("background-image")&&d.push(b);return d}function e(){for(var a=document.getElementsByTagName("video"),c=0;c<a.length;c++){for(var d=b(a[c]).siblings(),h,n,e=0;e<d.length;e++){var f=d[e];"IMG"==f.tagName&&(n=f.src);"image"==f.type&&(h=f)}n&&h&&b(h).click({imgsrc:n},g)}}function k(a){$parent=a.parent();try{"undefined"===typeof a.attr("src")&&(a.click({imgsrc:_neon.utils.getBackgroundImageUrl(a)},
g),$parent.click({imgsrc:_neon.utils.getBackgroundImageUrl(a)},g));a.click({imgsrc:a.attr("src")},g);$parent.click({imgsrc:a.attr("src")},g);$parent=a.parent();var c=$parent.attr("href");if("undefined"!=typeof c&&""!=c){var d=$parent.parent().parent();console.log(d);if("listElmnt"==d.prop("class")){var h=b(d.children()[0]),n=h.find("a");n.click({imgsrc:a.attr("src")},g);for(var e=b(d.children()[1]),c=0;c<e.length;c++)if("listElmnt-blogItem"==e.prop("class"))for(var f=e.children(),d=0;d<f.length;d++)for(var l=
b(f[d]).find("a"),h=0;h<l.length;h++)b(l[h]).click({imgsrc:a.attr("src")},g)}else-1<d.prop("class").indexOf("grid")&&(h=b(d.children()[1]),n=h.find("a"),n.click({imgsrc:a.attr("src")},g))}}catch(k){console.log("registgerClick",k)}}function g(a){lastMouseClick=(new Date).getTime();var c=a.data.imgsrc,d=b(this).offset(),h=d.left-b(window).scrollLeft(),n=d.top-b(window).scrollTop(),e=d.left,d=d.top,f=p[c];"undefined"!==typeof f&&(c=f[0],f=f[1],"undefined"!==typeof t[f]&&50>lastMouseClick-t[f]||(t[f]=
lastMouseClick,_neon.TrackerEvents.sendImageClickEvent(c,f,h,n,e,d,a.clientX,a.clientY)))}function m(a,c,d){if(1>c.length)d(a,c,"");else{var b=_neon.tracker.getNeonPublisherId(),b="http://i1.neon-images.com/v1/getthumbnailid/"+(b+"/?params="+c.join()),h=new XMLHttpRequest;h&&((new Date).getTime(),h.onreadystatechange=function(){4==h.readyState&&200==h.status&&(thumbCSV=h.responseText,d(a,c,thumbCSV))});h.open("GET",b,!0);h.send()}}function c(){var c=[],f=[];b("img").each(function(){b(this);var a=
b(this).attr("src");l(a)&&(f.push(b(this)),h(a)&&(a=u(a),c.push(a)),k(b(this)))});q=a();for(var g=0;g<q.length;g++){var r=q[g],n=_neon.utils.getBackgroundImageUrl(r);l(n)&&(f.push(b(r)),h(n)&&(n=u(n),c.push(n)),k(b(r)))}m(f,c,d);e()}function d(a,c,d){var b=d.split(",");d={};for(var f=0;f<c.length;f++)d[c[f]]=b[f];p={};imgVisibleSizes={};imgURLs=[];for(f=0;f<a.length;f++){b=a[f];c=b.is("img")?b.attr("src"):_neon.utils.getBackgroundImageUrl(b);if(h(c)){var e=v(c);p[c]=[e,d[e]]}else p[c]=r(c);imgURLs.push(c);
imgVisibleSizes[c]=[b.width(),b.height()]}_neon.TrackerEvents.sendImagesLoadedEvent(p,imgVisibleSizes);w(imgURLs)}function l(a){return"undefined"===typeof a?!1:-1<a.indexOf("neontn")||-1<a.indexOf("neonvid")?!0:!1}function h(a){return"undefined"===typeof a?!1:-1<a.indexOf("neonvid")?!0:!1}function f(){b(window).bind("load",function(){c()})}function w(a){b("img").appear();for(var c={},d={},h=[],f=0;f<a.length;f++){var e=b('img[src$="'+a[f]+'"]');h.push(e);c[a[f]]=0;d[a[f]]=0}var g={};setInterval(function(){for(var a=
{},b=!1,f=0;f<h.length;f++){var e=h[f];e.is(":appeared")&&(e=e.attr("src"),p.hasOwnProperty(e)&&(vidId=p[e][0],thumbId=p[e][1],g.hasOwnProperty(e)||(c[e]=1,_neon.StorageModule.storeThumbnail(vidId,thumbId)),a[e]=1,b=!0))}for(f=0;f<q.length;f++)e=q[f],_neon.utils.isOnScreen(e)&&(e=_neon.utils.getBackgroundImageUrl(e),p.hasOwnProperty(e)&&(vidId=p[e][0],thumbId=p[e][1],g.hasOwnProperty(e)||(c[e]=1,_neon.StorageModule.storeThumbnail(vidId,thumbId)),a[e]=1,b=!0));if(b){g=a;var a=[],l;for(l in c)1===c[l]&&
0==d[l]&&(d[l]=1,a.push(p[l]));0<a.length&&_neon.TrackerEvents.sendImagesVisibleEvent(a)}},1E3);b(window).bind("beforeunload",function(){_neon.StorageModule.getAllThumbnails("session")})}function r(a){if(a=/neontn[A-Z,a-z,0-9,-]*_[A-Z,a-z,0-9,-]*_[A-Z,a-z,0-9,-]*/.exec(a))return tid=a[0],[tid.split("_")[1],tid]}function v(a){return/neonvid_[A-Z,a-z,0-9,_]*/.exec(a)[0].split("neonvid_")[1]}function u(a){if(-1<a.indexOf("neontn"))return r(a)[0];if(-1<a.indexOf("neonvid"))return v(a)}var s,p,q=[],t=
{};return{init:function(){f();if("undefined"!==typeof neonPublisherId)s=neonPublisherId;else for(var a=document.getElementsByTagName("script"),c=0;c<a.length;c++){sTag=a[c];if(0<=sTag.src.search("neonbootloader")||0<=sTag.src.search("neonbctracker.js"))s=sTag.id;0<=sTag.src.search("neonoptimizer")&&(s=sTag.src.split("_")[1].split(".js")[0])}},getTrackerAccountId:function(){return s},getTrackerType:function(){return"brightcove"},getLastClickNeonElementTS:function(){return lastMouseClick},getLastClickNeonElement:function(){return lastMouseClickElement},
setLastClickNeonElement:function(a){lastMouseClick=(new Date).getTime();lastMouseClickElement=a},getNeonPublisherId:function(){return s},mapImagesToTids:c}}();_neon.StorageModule=function(){function a(a){return a.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/)[2]}function b(a,d){"undefined"===typeof d&&(d="neonThumbnails");if("undefined"===typeof a){var e=document.URL.split("?")[0];return d+"+"+e}return d+"+"+a}function k(a,d,g){var h=parseInt((new Date).getTime()/1E3,10);storageKey=a==localStorage?"neonThumbnails":
b();var f=JSON.parse(a.getItem(storageKey));f||(f={});f[d]={thumbId:g,ts:h};a.setItem(storageKey,JSON.stringify(f))}function g(a,b,e){return(a=JSON.parse(a.getItem(b)))?a[e]:!1}function m(a){return ret=g(localStorage,"neonThumbnails",a)}return{getUid:function(){var a=localStorage.getItem("uid");a||(a=(new Date).getTime(),a=_neon.utils.getRandomString(4)+_neon.utils.getRandomString(4)+a.toString().substring(11,13),localStorage.setItem("uid",a));return a},storeThumbnail:function(a,b){k(sessionStorage,
a,b);k(localStorage,a,b)},getThumbnail:function(c,d){var l="session",h=b(d);return(h=g(sessionStorage,h,c))?[h,l]:d&&a(document.URL)!=a(d)?null:(h=m(c))?[h,"local"]:null},getThumbnailSessionStorage:function(a,d){var l=b(d);return g(sessionStorage,l,a)},getThumbnailLocalStorage:function(a){return m(a)},getAllThumbnails:function(a){if("session"==a){a=/neonThumbnails/;for(var b=0;b<sessionStorage.length;b++){var e=sessionStorage.key(b);if(a.test(e))return sessionStorage.getItem(e)}return null}return JSON.parse(localStorage.getItem("neonThumbnails"))},
clearPageSessionData:function(a){if("undefined"===typeof a){a=document.URL.split("?")[0];a=b(a);for(var d=0;d<sessionStorage.length;d++){var g=sessionStorage.key(d);g==a&&sessionStorage.removeItem(g)}}}}}();_neon.TrackerEvents=function(){function a(a){g=_neon.tracker.getTrackerAccountId();m=_neon.tracker.getTrackerType();c=document.URL.split("?")[0];d=document.referrer.split("?")[0];var b=(new Date).getTime();"undefined"!==typeof a&&(b=a);return"http://tracker.neon-images.com/v2/track?a="+l+"&page="+
encodeURIComponent(c)+"&pageid="+k+"&ttype="+m+"&ref="+encodeURIComponent(d)+"&tai="+g+"&cts="+b}function b(a,c){var d=[],e;for(e in a)a[e]&&(tid=a[e][1],"undefined"!==typeof c&&(tid+="+"+c[e][0]+"+"+c[e][1]),d.push(tid));return d}var k=_neon.utils.getPageRequestUUID(),g,m,c,d,l;return{sendImageClickEvent:function(b,c,d,e,g,k,m,p){l="ic";var q=a(),q=q+("&vid="+b+"&tid="+c);"undefined"!==typeof d&&"undefined"!==typeof e&&"undefined"!==typeof g&&"undefined"!==typeof k&&"undefined"!==typeof m&&(q+="&wx="+
d+"&wy="+e+"&x="+g+"&y="+k+"&cx="+m+"&cy="+p);_neon.JsonRequester.sendRequest(q)},sendVideoPlayEvent:function(b,c,d,e,g,k){l="vp";var m=a(),m=m+("&vid="+b+"&tid="+c+"&adPlay="+e+"&adelta="+g+"&pcount="+k);"undefined"!==typeof d&&(m+="&playerid="+d);_neon.JsonRequester.sendRequest(m)},sendAdPlayEvent:function(b,c,d,e,g,k){l="ap";k=a(k);k+="&vid="+b+"&tid="+c+"&adelta="+e+"&pcount="+g;"undefined"!==typeof d&&(k+="&playerid="+d);_neon.JsonRequester.sendRequest(k)},sendImagesVisibleEvent:function(c){l=
"iv";c=b(c);var d=a();_neon.JsonRequester.sendRequest(d+("&tids="+c))},sendImagesLoadedEvent:function(c,d){l="il";var g=b(c,d),k=a();_neon.JsonRequester.sendRequest(k+("&tids="+g))},sendVideoClickEvent:function(b,c,d){l="vc";var e=a();_neon.JsonRequester.sendRequest(e+("&vid="+b+"&tid="+c+"&playerid="+d))},setPageLoadId:function(a){k=a},getPageLoadId:function(){return k}}}();(function(){function a(){if("complete"===document.readyState||"interactive"===document.readyState)_neon.StorageModule.clearPageSessionData(),
clearInterval(e),b(document).bind("touchstart",function(a){lastMouseClick=(new Date).getTime()}),NeonPlayerTracker=_neon.BCNeonPlayerTracker}if(!_neon.UNITTEST){var e=setInterval(a,100);sessionStorage&&localStorage&&JSON&&_neon.tracker.init()}})()})(_neonjQuery);
